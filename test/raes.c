#include <rlib/rlib.h>

RTEST (raes, new_args, RTEST_FAST)
{
  ruint8 key[32] = { 0 };

  r_assert_cmpptr (r_cipher_aes_new (0, NULL), ==, NULL);
  r_assert_cmpptr (r_cipher_aes_new (128, NULL), ==, NULL);
  r_assert_cmpptr (r_cipher_aes_new (0, key), ==, NULL);
  r_assert_cmpptr (r_cipher_aes_new (129, key), ==, NULL);
  r_assert_cmpptr (r_cipher_aes_new (255, key), ==, NULL);
}
RTEST_END;

typedef struct {
  rsize keybits;
  const rchar * key;
  const rchar * iv;
  const rchar * plaintxt;
  const rchar * ciphertxt;
} RCryptoCipherTestData;

RCryptoCipherTestData ECB_block_test_data[] = {
  /* Subset of the Official NIST test vectors */
  { 128, "00000000000000000000000000000000", NULL, "f34481ec3cc627bacd5dc3fb08f273e6", "0336763e966d92595a567cc9ce537f5e" },
  { 128, "00000000000000000000000000000000", NULL, "9798c4640bad75c7c3227db910174e72", "a9a1631bf4996954ebc093957b234589" },
  { 128, "00000000000000000000000000000000", NULL, "96ab5c2ff612d9dfaae8c31f30c42168", "ff4f8391a6a40ca5b25d23bedd44a597" },
  { 128, "00000000000000000000000000000000", NULL, "6a118a874519e64e9963798a503f1d35", "dc43be40be0e53712f7e2bf5ca707209" },
  { 128, "00000000000000000000000000000000", NULL, "cb9fceec81286ca3e989bd979b0cb284", "92beedab1895a94faa69b632e5cc47ce" },
  { 128, "00000000000000000000000000000000", NULL, "b26aeb1874e47ca8358ff22378f09144", "459264f4798f6a78bacb89c15ed3d601" },
  { 128, "00000000000000000000000000000000", NULL, "58c8e00b2631686d54eab84b91f0aca1", "08a4e2efec8a8e3312ca7460b9040bbf" },
  { 128, "10a58869d74be5a374cf867cfb473859", NULL, "00000000000000000000000000000000", "6d251e6944b051e04eaa6fb4dbf78465" },
  { 128, "caea65cdbb75e9169ecd22ebe6e54675", NULL, "00000000000000000000000000000000", "6e29201190152df4ee058139def610bb" },
  { 128, "a2e2fa9baf7d20822ca9f0542f764a41", NULL, "00000000000000000000000000000000", "c3b44b95d9d2f25670eee9a0de099fa3" },
  { 128, "b6364ac4e1de1e285eaf144a2415f7a0", NULL, "00000000000000000000000000000000", "5d9b05578fc944b3cf1ccf0e746cd581" },
  { 128, "64cf9c7abc50b888af65f49d521944b2", NULL, "00000000000000000000000000000000", "f7efc89d5dba578104016ce5ad659c05" },
  { 128, "47d6742eefcc0465dc96355e851b64d9", NULL, "00000000000000000000000000000000", "0306194f666d183624aa230a8b264ae7" },
  { 128, "00000000000000000000000000000000", NULL, "ffffffffffffffffffffffffffffff80", "d1788f572d98b2b16ec5d5f3922b99bc" },
  { 128, "00000000000000000000000000000000", NULL, "ffffffffffffffffffffffffffffffc0", "0833ff6f61d98a57b288e8c3586b85a6" },
  { 128, "00000000000000000000000000000000", NULL, "ffffffffffffffffffffffffffffffe0", "8568261797de176bf0b43becc6285afb" },
  { 128, "00000000000000000000000000000000", NULL, "fffffffffffffffffffffffffffffff0", "f9b0fda0c4a898f5b9e6f661c4ce4d07" },
  { 128, "00000000000000000000000000000000", NULL, "fffffffffffffffffffffffffffffff8", "8ade895913685c67c5269f8aae42983e" },
  { 128, "00000000000000000000000000000000", NULL, "fffffffffffffffffffffffffffffffc", "39bde67d5c8ed8a8b1c37eb8fa9f5ac0" },
  { 128, "00000000000000000000000000000000", NULL, "fffffffffffffffffffffffffffffffe", "5c005e72c1418c44f569f2ea33ba54f3" },
  { 128, "00000000000000000000000000000000", NULL, "ffffffffffffffffffffffffffffffff", "3f5b8cc9ea855a0afa7347d23e8d664e" },
  { 192, "000000000000000000000000000000000000000000000000", NULL, "1b077a6af4b7f98229de786d7516b639", "275cfc0413d8ccb70513c3859b1d0f72" },
  { 192, "000000000000000000000000000000000000000000000000", NULL, "9c2d8842e5f48f57648205d39a239af1", "c9b8135ff1b5adc413dfd053b21bd96d" },
  { 192, "000000000000000000000000000000000000000000000000", NULL, "bff52510095f518ecca60af4205444bb", "4a3650c3371ce2eb35e389a171427440" },
  { 192, "000000000000000000000000000000000000000000000000", NULL, "51719783d3185a535bd75adc65071ce1", "4f354592ff7c8847d2d0870ca9481b7c" },
  { 192, "000000000000000000000000000000000000000000000000", NULL, "26aa49dcfe7629a8901a69a9914e6dfd", "d5e08bf9a182e857cf40b3a36ee248cc" },
  { 192, "000000000000000000000000000000000000000000000000", NULL, "941a4773058224e1ef66d10e0a6ee782", "067cd9d3749207791841562507fa9626" },
  { 192, "fffffffffffffffffff00000000000000000000000000000", NULL, "00000000000000000000000000000000", "32752eefc8c2a93f91b6e73eb07cca6e" },
  { 192, "fffffffffffffffffff80000000000000000000000000000", NULL, "00000000000000000000000000000000", "d893e7d62f6ce502c64f75e281f9c000" },
  { 192, "fffffffffffffffffffc0000000000000000000000000000", NULL, "00000000000000000000000000000000", "8dfd999be5d0cfa35732c0ddc88ff5a5" },
  { 192, "fffffffffffffffffffe0000000000000000000000000000", NULL, "00000000000000000000000000000000", "02647c76a300c3173b841487eb2bae9f" },
  { 192, "ffffffffffffffffffff0000000000000000000000000000", NULL, "00000000000000000000000000000000", "172df8b02f04b53adab028b4e01acd87" },
  { 192, "ffffffffffffffffffff8000000000000000000000000000", NULL, "00000000000000000000000000000000", "054b3bf4998aeb05afd87ec536533a36" },
  { 192, "e9f065d7c13573587f7875357dfbb16c53489f6a4bd0f7cd", NULL, "00000000000000000000000000000000", "0956259c9cd5cfd0181cca53380cde06" },
  { 192, "15d20f6ebc7e649fd95b76b107e6daba967c8a9484797f29", NULL, "00000000000000000000000000000000", "8e4e18424e591a3d5b6f0876f16f8594" },
  { 192, "a8a282ee31c03fae4f8e9b8930d5473c2ed695a347e88b7c", NULL, "00000000000000000000000000000000", "93f3270cfc877ef17e106ce938979cb0" },
  { 192, "cd62376d5ebb414917f0c78f05266433dc9192a1ec943300", NULL, "00000000000000000000000000000000", "7f6c25ff41858561bb62f36492e93c29" },
  { 192, "502a6ab36984af268bf423c7f509205207fc1552af4a91e5", NULL, "00000000000000000000000000000000", "8e06556dcbb00b809a025047cff2a940" },
  { 192, "25a39dbfd8034f71a81f9ceb55026e4037f8f6aa30ab44ce", NULL, "00000000000000000000000000000000", "3608c344868e94555d23a120f8a5502d" },
  { 256, "0000000000000000000000000000000000000000000000000000000000000000", NULL, "014730f80ac625fe84f026c60bfd547d", "5c9d844ed46f9885085e5d6a4f94c7d7" },
  { 256, "0000000000000000000000000000000000000000000000000000000000000000", NULL, "0b24af36193ce4665f2825d7b4749c98", "a9ff75bd7cf6613d3731c77c3b6d0c04" },
  { 256, "0000000000000000000000000000000000000000000000000000000000000000", NULL, "761c1fe41a18acf20d241650611d90f1", "623a52fcea5d443e48d9181ab32c7421" },
  { 256, "0000000000000000000000000000000000000000000000000000000000000000", NULL, "8a560769d605868ad80d819bdba03771", "38f2c7ae10612415d27ca190d27da8b4" },
  { 256, "0000000000000000000000000000000000000000000000000000000000000000", NULL, "91fbef2d15a97816060bee1feaa49afe", "1bc704f1bce135ceb810341b216d7abe" },
  { 256, "c47b0294dbbbee0fec4757f22ffeee3587ca4730c3d33b691df38bab076bc558", NULL, "00000000000000000000000000000000", "46f2fb342d6f0ab477476fc501242c5f" },
  { 256, "28d46cffa158533194214a91e712fc2b45b518076675affd910edeca5f41ac64", NULL, "00000000000000000000000000000000", "4bf3b0a69aeb6657794f2901b1440ad4" },
  { 256, "c1cc358b449909a19436cfbb3f852ef8bcb5ed12ac7058325f56e6099aab1a1c", NULL, "00000000000000000000000000000000", "352065272169abf9856843927d0674fd" },
  { 256, "984ca75f4ee8d706f46c2d98c0bf4a45f5b00d791c2dfeb191b5ed8e420fd627", NULL, "00000000000000000000000000000000", "4307456a9e67813b452e15fa8fffe398" },
  { 256, "b43d08a447ac8609baadae4ff12918b9f68fc1653f1269222f123981ded7a92f", NULL, "00000000000000000000000000000000", "4663446607354989477a5c6f0f007ef4" },
  { 256, "1d85a181b54cde51f0e098095b2962fdc93b51fe9b88602b3f54130bf76a5bd9", NULL, "00000000000000000000000000000000", "531c2c38344578b84d50b3c917bbb6e1" },
  { 256, "fffffffffffffffffffffffffffffffffffffffffffc00000000000000000000", NULL, "00000000000000000000000000000000", "10dffb05904bff7c4781df780ad26837" },
  { 256, "fffffffffffffffffffffffffffffffffffffffffffe00000000000000000000", NULL, "00000000000000000000000000000000", "c33bc13e8de88ac25232aa7496398783" },
  { 256, "ffffffffffffffffffffffffffffffffffffffffffff00000000000000000000", NULL, "00000000000000000000000000000000", "ca359c70803a3b2a3d542e8781dea975" },
  { 256, "ffffffffffffffffffffffffffffffffffffffffffff80000000000000000000", NULL, "00000000000000000000000000000000", "bcc65b526f88d05b89ce8a52021fdb06" },

  /* These test vectors I found on InCON team website */
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", NULL, "6bc1bee22e409f96e93d7e117393172a", "3ad77bb40d7a3660a89ecaf32466ef97" },
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", NULL, "ae2d8a571e03ac9c9eb76fac45af8e51", "f5d3d58503b9699de785895a96fdbaaf" },
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", NULL, "30c81c46a35ce411e5fbc1191a0a52ef", "43b1cd7f598ece23881b00e3ed030688" },
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", NULL, "f69f2445df4f9b17ad2b417be66c3710", "7b0c785e27e8ad3f8223207104725dd4" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", NULL, "6bc1bee22e409f96e93d7e117393172a", "bd334f1d6e45f25ff712a214571fa5cc" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", NULL, "ae2d8a571e03ac9c9eb76fac45af8e51", "974104846d0ad3ad7734ecb3ecee4eef" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", NULL, "30c81c46a35ce411e5fbc1191a0a52ef", "ef7afd2270e2e60adce0ba2face6444e" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", NULL, "f69f2445df4f9b17ad2b417be66c3710", "9a4b41ba738d6c72fb16691603c18e0e" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", NULL, "6bc1bee22e409f96e93d7e117393172a", "f3eed1bdb5d2a03c064b5a7e3db181f8" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", NULL, "ae2d8a571e03ac9c9eb76fac45af8e51", "591ccb10d410ed26dc5ba74a31362870" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", NULL, "30c81c46a35ce411e5fbc1191a0a52ef", "b6ed21b99ca6f4f9f153e7b1beafed1d" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", NULL, "f69f2445df4f9b17ad2b417be66c3710", "23304b7a39f9f3ff067d8d8f9e24ecc7" },
};


RTEST_LOOP (raes, ecb_block, RTEST_FAST, 0, R_N_ELEMENTS (ECB_block_test_data))
{
  RCryptoCipherTestData * data = &ECB_block_test_data[__i];
  RCryptoCipher * cipher;
  ruint8 plaintxt[R_AES_BLOCK_BYTES];
  ruint8 ciphertxt[R_AES_BLOCK_BYTES];
  ruint8 out[R_AES_BLOCK_BYTES] = { 0 };

  r_assert_cmpuint (r_str_hex_to_binary (data->plaintxt, plaintxt, R_AES_BLOCK_BYTES), ==, R_AES_BLOCK_BYTES);
  r_assert_cmpuint (r_str_hex_to_binary (data->ciphertxt, ciphertxt, R_AES_BLOCK_BYTES), ==, R_AES_BLOCK_BYTES);

  r_assert_cmpptr ((cipher = r_cipher_aes_new_from_hex (data->key)), !=, NULL);
  r_assert_cmpuint (cipher->keybits, ==, data->keybits);

  /* encrypt */
  r_assert (r_cipher_aes_ecb_encrypt_block (cipher, plaintxt, out));
  r_assert_cmpmem (out, ==, ciphertxt, R_AES_BLOCK_BYTES);

  /* decrypt */
  r_assert (r_cipher_aes_ecb_decrypt_block (cipher, ciphertxt, out));
  r_assert_cmpmem (out, ==, plaintxt, R_AES_BLOCK_BYTES);

  r_crypto_cipher_unref (cipher);
}
RTEST_END;

RCryptoCipherTestData ECB_mmt_test_data[] = {
  { 128, "edfdb257cb37cdf182c5455b0c0efebb", NULL, "1695fe475421cace3557daca01f445ff", "7888beae6e7a426332a7eaa2f808e637" },
  { 128, "7723d87d773a8bbfe1ae5b081235b566", NULL, "1b0a69b7bc534c16cecffae02cc5323190ceb413f1db3e9f0f79ba654c54b60e", "ad5b089515e7821087c61652dc477ab1f2cc6331a70dfc59c9ffb0c723c682f6" },
  { 128, "280afe063216a10b9cad9b2095552b16", NULL, "6f172bb6ec364833411841a8f9ea2051735d600538a9ea5e8cd2431a432903c1d6178988b616ed76e00036c5b28ccd8b", "4cc2a8f13c8c7c36ed6a814db7f26900c7e04df49cbad916ce6a44d0ae4fe7edc0b402794675b3694933ebbc356525d8" },
  { 128, "ef60fb1400c83936414a25651eb51a1b", NULL, "593559318cc66bf695e49feb42794bdfb66bce895ec222ca2609b133ecf66ac7344d13021e01e11a969c4684cbe20abae2b19d3ceb2cacd41419f21f1c865149", "3ea6f4305217bd47eebe773da4b578549cac744c00cbd8f9d596d38010304bd850cc2f4b19a91c2e022eabf100266185ca2705127815dfd46efbe4ecd46a3058" },
  { 128, "c5805cd1c4a7b98a715badb709720bf4", NULL, "84f809fc5c84652376cc0df10095bc00b9f0547fa91a2d3310a0adbc9cc6191ade2aaa6fffa5e406af7223955f9277bfb06eb1dd2bbfbefe32ab342c36302bf22bc64e1b394032bbb5f4e6744f1bcbf2", "a6dc096bc21b0658e416a0f679fefc6e958e9c56e3ce04fdf6e392c2db770a60d9523c255925e14a3e02a1002bf3875c2e501bac618bee1f55f9850454854eef9d693d90937cc8387b6f4c4414e2080b" },
  { 128, "4c35be028e1475278346eae531cbee5c", NULL, "7adcf4a494f6b09790c82c8bb97db62c5d3fa4032f06dfeceaad9ecb374b747bd1c08d07e78e351dc2eb99bfa714d23cffe31f5fb5a472e6e0252f35a20c304c4f6d0cf7d29c99444d40af3a00a92fc86c6444fcb80ce9765362ac1bdba0b10e", "22217953f71932ab4360d97ef495081559f1fcb09caca41fa0c65f7b1792b560eabe18f3b3b06ef80c41886f24c5d6d32d20427e83d8b5564d9ac7435a2842c1cf7c6fcc229eb7f518d3e0167d510efbaee39a0438fc800eb6acfc203c93280c" },
  { 128, "00cc73c990d376b82246e45ea3ae2e37", NULL, "37a1205ea929355d2e4ee52d5e1d9cda279ae01e640287ccb153276e7e0ecf2d633cf4f2b3afaecb548a2590ce0445c6a168bac3dc601813eb74591bb1ce8dfcd740cdbb6388719e8cd283d9cc7e736938240b410dd5a6a48ba49dd2066503e63ab592ffdf3be49e7d2de74f82158b8c", "c88e03383ba9da6f982c057fe92c0bb3ed5b9cd18295a100e13a4e12d440b919bbb8b221abead362902ce44d30d0b80e56bee1f66a7d8de0b1e1b4dbf76c90c1807a3bc5f277e9814c82ab120f7e10217dfdf6092ce4958f8906c5e32279c6537dd1fbae20cb7a1d9f89d0490b6aefc1" },
  { 128, "0a53aa7a3e4a4f364e8c6c7224af5501", NULL, "eaf1760c0f25310dada6debeb966304db7a9f1b2d1c3af922623b263649031d299b3c56146d61d55b6ebf4cf8dd04039a4d1ace3146f49ee915f806afad64cbb2d04a64120de40382e2175dcae9480d1ca8dedc38fb64e4a40112f10f03a4c354fed01f2c5c7017dbd514b2d443a5adfd2e49c986723266cda41a69e6e459908", "5ece70a44da41bc7cfb9b582ea9ce0980030ec4af331e76499961f88860aa0554aba3ecbf77ca4293a3fee854a2caf3ae800343fb4521388b16b6dc599b3d60bf82777f98e1a8d04ab9cd54dd9a248095795d4dfe4858bfd9a05f54c795bb086e15f7c22228184ec66a9ca10b1cf71a6bb9303c5cd1dcc056460a86df651f053" },
  { 192, "61396c530cc1749a5bab6fbcf906fe672d0c4ab201af4554", NULL, "60bcdb9416bac08d7fd0d780353740a5", "24f40c4eecd9c49825000fcb4972647a" },
  { 192, "c9c86a51224e5f1916d3f33a602f697afc852a2c44d30d5f", NULL, "64145e61e61cd96f796b187464fabbde6f42e693f501f1d73b3c606f00801506", "502a73e4051cfac8fe6343211a129f5a5f56710c41b32c84da978dda2cec34ad" },
  { 192, "c4854919c324d381bbef9bea771172f6e4563ffbd1e1e956", NULL, "07d3781a71e87b8cf12cac4616f9c7a819be57a0770a7a66e0e6e469506826897c8530866f2715b8757f0f01389dc301", "0b0455954e477e87d1a338414f8ac4d760efb70e5770e5d496b31152cb07e9316378f7fd38c6903b31d4f1b1a53931af" },
  { 192, "3deecf7a037ebb2ada805e8059bfaeaebb195cace379fcd2", NULL, "096612f4111ebdb9accf5efbb973589e5a2c9103407ed2da29bc7137a6c02de822df5907201d3dcbc49cb9a3955b2b86811d938422a6f5a23f2dffe4960fecab", "d375e1af5fcd03e31d0f735f6bc5d7e773bc34ff3eb706be85842f998e4e361303825b848170608f300ad1ced848b5233477f53710503c55736a730595599964" },
  { 192, "0c0333d8fe3e99a1eecc120d6b54bb8faa888d12794de93e", NULL, "6f825ad0e2fcabd811db11e2840f0884470b87eaa678e329342bf0d1125569c16dfa924049a51b497d594825ffca4f4062cd02359d0ead2b0e014264bf1bb313e741a06eb4813205470047520133cf91", "e6128a9fb497b2ec0d0e9fe1b24e691ea36c0628eb55046b2f20de9d281dd9dbbbeaa0519a4875d3516b15022330163b2798a9102ee9d141a3416c1a277442d4cf1fec87ccea571a23b91a461991ec0d" },
  { 192, "b07da99fbe0b193e5336141a9819974b1a9a4102129db861", NULL, "27756c11f57c40169f95f25141fb1a07d9444d864e4c43b9b16f39fbc2fb9529b6e4c9fb37ba7994add9e057bce070fd0d64b8e452e58baa84005ffb6fe7f3a7710f35f87f28624268526fbb5e8ea88db272972adf2227e0ca7b09ad48915754", "7516e53877236e931e7fbae22ed2ca5116b72a700f6e397c2aa47c304b3f5c2a026d89831a5104ae7b73ef48de709c1b9e661ae973dea6bb38217a7650228ccc6b228b33f567121427e9f21cbd3ec6aa35ebba336f51ed8e4bf6e75c5866bc20" },
  { 192, "80da652b1844dafe4fd4ca8ccc26b564b263711723b6cd48", NULL, "1e49e9541ed0f97023f8205e71fe75668680f12fb5902d7a11066d108c1adef960321cefaef8f71365b077de66c91e59e6b16c9113eea945fa6bdee3a80f25b38f9422512c97d260e7eb837d3b33247216b0bfac835744f08627884947b98d4573190460e0d410c170524d2437661118", "a47e7d0d8266595792bc980bf3c47822229e4428cc91aa1b15519823a133dd479a4664ec8408b4d9301760454ed2037279d996eb1ccc98df77660aa97422dca1c54d7bfac37223d0caee6a6b34d760e767b9595f7f3bb631d6545a7442d3497a7b85054e8b99d24e65df985e5bccf450" },
  { 192, "9a35954f400034b29c9f85766a255cf1393dccb8d6c93e65", NULL, "823fade2722805e4948db57639cbb67d477d4b01319d927826ec594789933486a20acc0393397a8a8ddd1564432e081e9fbfa78cb4a5c30cf5db7b0fa4e556d68db48f7af3cab02fcb9e62c928428480f7437af0ecd1c864bc1fdf538d0d362baa059d4e7c22cf5ab69846aecf50532ab5d26d35c068ca05e4802c1b2c53fe0c", "52c54ec4345e776b84952f5803ad3a52ba4cfedb32c2dc146ecc8813705f02fd3d4d559027e895e2ba29710396272436c398fa12ba02c85c02947df8035647334bc6c53e1d716f582206c8538f397784c3e42f535b68e8151b3cff71a82d2785b0eb298ff63aebc5d822549f44fbbcf0b69114323c9572d0bf674332fac3b57d" },
  { 256, "cc22da787f375711c76302bef0979d8eddf842829c2b99ef3dd04e23e54cc24b", NULL, "ccc62c6b0a09a671d64456818db29a4d", "df8634ca02b13a125b786e1dce90658b" },
  { 256, "7a52e4d342aa07255a7e7c34266cf7302abe2d4dd7ec4468a46187ee61825ffa", NULL, "7e771c6ee4b26db89050e982ba7e9803c8da34606434dd85d2910e538076d001", "a91d8b2ddf37520bc469470ad0dd6394923143ce55386beb1f9c4bd51584658e" },
  { 256, "605c4139c961b496ca5148f1bdb1bb1901f2101943a0ec10fcdc403d3b0c285a", NULL, "68c9885ba2be03181f65f1e04e83d6ba6880467550bcf099be26dc9d9c0af15ab02abac07c116ac862a41da90cfa604f", "a7603d29bbba4c77208bf2f3df9f5ec85204adce012299f2cce7b326ce78f5cf8040343dd291e8cf9f3645726368dc20" },
  { 256, "f984b0f534fc0ae2c0a8593e16ab8365f25fcc9c5947f9a2db45b588160d35c3", NULL, "351fee099122e371c4830f409c6c4411186d22176f7138b054f16b3c79679c2f520685651ba8e4b61c08dccb2c31982f743631a97524d2ca4d351ac23546c178", "8b9c9e692c16e7059818e285e85d8fa5433dee2aff9fec61d6a0a781e24b24f64902fbd18cef7461ad7760cfb2442fb74ffd9be108a386545f2a216430ef16fb" },
  { 256, "ba42b760bb5a5de21acb9aba214c9783cd71ea841ada018580abc4e1be3b76dd", NULL, "4b4b12d6ee6fc0bf987eaafe2634aad464781ff4c83d3f8a61a6af7c0a6d51f0e3855d0e02feb307652a6f562bfebe4604baf1b4e7cdd01603f231bcf7a0c95645a141b704008cd8d62979201a4c84e2", "fa18d25e37ea0ce94f0949efc0edecc6a40fada8f007fd8e760afed0a83ebb350c82b03baaa6ee19f791bb9bd1b44d27a76fc6eb0e1c0017d68776ed69a541851a732e46ef328def064baf6a0a755588" },
  { 256, "1d29079cc34ab5a3bc713f416a129f9d26ada15fca458cc2731404ea857d2f79", NULL, "b36809198132518d815aa37f32f40dd7a952ec8bd63355700837b450b396b33c72125e23482a84a42b916021c3de78156f85c6a78906167feb64afd8b1d935d641c8ce1a89f3849588eeeb9910d40336ca385fc37a5e87bb84ab9ccbb05b3a28", "7ae803b14914d156439f580c02c592bf9a41b7b80c20168129a33fae2290403f01a6fabe4fea7ac770ffbc6c421f8e013b9e831674ef17eb27d446dded3baf50686b809c18b6bbd588cd3c7423b64987e9164b7e1e66987dc9319790ae27b3e8" },
  { 256, "2e39c585ce4900d323ce29713bebe73a1be08a0cb22e9f1310fcc14ad4b9b23e", NULL, "e199899e1e12cffcb28909aec51b36c2f96fab49ef32b9650cc38aa37d2f4c8b785f9176c590f6a07e04037e13f7535290d5f5fc23aa1113d9dacf34a812749ab27ecfefc83dd3622d1285fa9d5c192a8e4857a5b6454473cdb8ff4594f1e906165e08b22effae6b491a55ca6d30ce73", "2c4998428e72f6d96e982a316f73bf2a7da81730909b65403489ab92ada6de11882d08742f90f0f109d3420b00b8abe6873f4fdd1474923da2c5bdea2e4523ffca2132015ecf7c9cac9de2f956b112c4ba8e4c8e4b354a3df6e4652d6a77ae982a24d15cff71b979538d49994fd38761" },
  { 256, "85405c4f0ebbe8f29228f02f1ff184e2f5e7857e8933c2a1d08f61ecb9b68111", NULL, "0f5321db6fd9d816d88e28183a739d90974e76095caa9f12f11fe49c8fd35fa3524132118f397cdf6728857d9c9a3c74a4fde44afca80aa5bf1cbab47789f2cb3394574dda5727cfbea96f7a74a07eb1e45599f49ce7f0056ac3d14929221c70dbd3f759f83ac22f06994ed96a8e49917eddfdd2e3703b78199c91234ca6c3dc", "2ac6de212da0434bea9cdd7332637307131d31e8c4b0c1fd02298e249bfa9f64f34aae45faadf79d971ae82b033d903f6b18adec171ec83ccd147b44d05dec5cedb574534e8901385534c3f1dae4aebee0eb2164975e8b4e85a7b5a766ffd8247885c2b6429eb659b92c8d953af92b54517933566654d804665112bec17ff3a4" },
};

RTEST_LOOP (raes, ecb, RTEST_FAST, 0, R_N_ELEMENTS (ECB_mmt_test_data))
{
  RCryptoCipherTestData * data = &ECB_mmt_test_data[__i];
  RCryptoCipher * cipher;
  ruint8 * plaintxt, * ciphertxt, * out;
  rsize plainsize, ciphersize;

  r_assert_cmpptr ((plaintxt = r_str_hex_mem (data->plaintxt, &plainsize)), !=, NULL);
  r_assert_cmpptr ((ciphertxt = r_str_hex_mem (data->ciphertxt, &ciphersize)), !=, NULL);
  r_assert_cmpuint (plainsize, ==, ciphersize);

  r_assert_cmpptr ((cipher = r_cipher_aes_new_from_hex (data->key)), !=, NULL);
  r_assert_cmpuint (cipher->keybits, ==, data->keybits);

  out = r_malloc (ciphersize);
  r_assert_cmpint (r_cipher_aes_ecb_encrypt (cipher, NULL, plaintxt, plainsize, out), ==, R_CRYPTO_CIPHER_OK);
  r_assert_cmpmem (out, ==, ciphertxt, ciphersize);

  r_assert_cmpint (r_cipher_aes_ecb_decrypt (cipher, NULL, ciphertxt, ciphersize, out), ==, R_CRYPTO_CIPHER_OK);
  r_assert_cmpmem (out, ==, plaintxt, plainsize);

  r_crypto_cipher_unref (cipher);
  r_free (plaintxt);
  r_free (ciphertxt);
  r_free (out);
}
RTEST_END;

RCryptoCipherTestData CBC_test_data[] = {
  /* Subset of the Official NIST test vectors */
  { 128, "1f8e4973953f3fb0bd6b16662e9a3c17", "2fe2b333ceda8f98f4a99b40d2cd34a8", "45cf12964fc824ab76616ae2f4bf0822", "0f61c4d44c5147c03c195ad7e2cc12b2" },
  { 128, "0700d603a1c514e46b6191ba430a3a0c", "aad1583cd91365e3bb2f0c3430d065bb", "068b25c7bfb1f8bdd4cfc908f69dffc5ddc726a197f0e5f720f730393279be91", "c4dc61d9725967a3020104a9738f23868527ce839aab1752fd8bdb95a82c4d00" },
  { 128, "3348aa51e9a45c2dbe33ccc47f96e8de", "19153c673160df2b1d38c28060e59b96", "9b7cee827a26575afdbb7c7a329f887238052e3601a7917456ba61251c214763d5e1847a6ad5d54127a399ab07ee3599", "d5aed6c9622ec451a15db12819952b6752501cf05cdbf8cda34a457726ded97818e1f127a28d72db5652749f0c6afee5" },
  { 128, "b7f3c9576e12dd0db63e8f8fac2b9a39", "c80f095d8bb1a060699f7c19974a1aa0", "9ac19954ce1319b354d3220460f71c1e373f1cd336240881160cfde46ebfed2e791e8d5a1a136ebd1dc469dec00c4187722b841cdabcb22c1be8a14657da200e", "19b9609772c63f338608bf6eb52ca10be65097f89c1e0905c42401fd47791ae2c5440b2d473116ca78bd9ff2fb6015cfd316524eae7dcb95ae738ebeae84a467" },
  { 192, "ba75f4d1d9d7cf7f551445d56cc1a8ab2a078e15e049dc2c", "531ce78176401666aa30db94ec4a30eb", "c51fc276774dad94bcdc1d2891ec8668", "70dd95a14ee975e239df36ff4aee1d5d" },
  { 192, "eab3b19c581aa873e1981c83ab8d83bbf8025111fb2e6b21", "f3d6667e8d4d791e60f7505ba383eb05", "9d4e4cccd1682321856df069e3f1c6fa391a083a9fb02d59db74c14081b3acc4", "51d44779f90d40a80048276c035cb49ca2a47bcb9b9cf7270b9144793787d53f" },
  { 192, "16c93bb398f1fc0cf6d68fc7a5673cdf431fa147852b4a2d", "eaaeca2e07ddedf562f94df63f0a650f", "c5ce958613bf741718c17444484ebaf1050ddcacb59b9590178cbe69d7ad7919608cb03af13bbe04f3506b718a301ea0", "ed6a50e0c6921d52d6647f75d67b4fd56ace1fedb8b5a6a997b4d131640547d22c5d884a75e6752b5846b5b33a5181f4" },
  { 192, "067bb17b4df785697eaccf961f98e212cb75e6797ce935cb", "8b59c9209c529ca8391c9fc0ce033c38", "db3785a889b4bd387754da222f0e4c2d2bfe0d79e05bc910fba941beea30f1239eacf0068f4619ec01c368e986fca6b7c58e490579d29611bd10087986eff54f", "d5f5589760bf9c762228fde236de1fa2dd2dad448db3fa9be0c4196efd46a35c84dd1ac77d9db58c95918cb317a6430a08d2fb6a8e8b0f1c9b72c7a344dc349f" },
  { 256, "6ed76d2d97c69fd1339589523931f2a6cff554b15f738f21ec72dd97a7330907", "851e8764776e6796aab722dbb644ace8", "6282b8c05c5c1530b97d4816ca434762", "6acc04142e100a65f51b97adf5172c41" },
  { 256, "dce26c6b4cfb286510da4eecd2cffe6cdf430f33db9b5f77b460679bd49d13ae", "fdeaa134c8d7379d457175fd1a57d3fc", "50e9eee1ac528009e8cbcd356975881f957254b13f91d7c6662d10312052eb00", "2fa0df722a9fd3b64cb18fb2b3db55ff2267422757289413f8f657507412a64c" },
  { 256, "fe8901fecd3ccd2ec5fdc7c7a0b50519c245b42d611a5ef9e90268d59f3edf33", "bd416cb3b9892228d8f1df575692e4d0", "8d3aa196ec3d7c9b5bb122e7fe77fb1295a6da75abe5d3a510194d3a8a4157d5c89d40619716619859da3ec9b247ced9", "608e82c7ab04007adb22e389a44797fed7de090c8c03ca8a2c5acd9e84df37fbc58ce8edb293e98f02b640d6d1d72464" },
  { 256, "0493ff637108af6a5b8e90ac1fdf035a3d4bafd1afb573be7ade9e8682e663e5", "c0cd2bebccbb6c49920bd5482ac756e8", "8b37f9148df4bb25956be6310c73c8dc58ea9714ff49b643107b34c9bff096a94fedd6823526abc27a8e0b16616eee254ab4567dd68e8ccd4c38ac563b13639c", "05d5c77729421b08b737e41119fa4438d1f570cc772a4d6c3df7ffeda0384ef84288ce37fc4c4c7d1125a499b051364c389fd639bdda647daa3bdadab2eb5594" },

  /* These test vectors I found on InCON team website */
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", "000102030405060708090A0B0C0D0E0F", "6bc1bee22e409f96e93d7e117393172a", "7649abac8119b246cee98e9b12e9197d" },
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", "7649ABAC8119B246CEE98E9B12E9197D", "ae2d8a571e03ac9c9eb76fac45af8e51", "5086cb9b507219ee95db113a917678b2" },
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", "5086CB9B507219EE95DB113A917678B2", "30c81c46a35ce411e5fbc1191a0a52ef", "73bed6b8e3c1743b7116e69e22229516" },
  { 128, "2b7e151628aed2a6abf7158809cf4f3c", "73BED6B8E3C1743B7116E69E22229516", "f69f2445df4f9b17ad2b417be66c3710", "3ff1caa1681fac09120eca307586e1a7" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", "000102030405060708090A0B0C0D0E0F", "6bc1bee22e409f96e93d7e117393172a", "4f021db243bc633d7178183a9fa071e8" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", "4F021DB243BC633D7178183A9FA071E8", "ae2d8a571e03ac9c9eb76fac45af8e51", "b4d9ada9ad7dedf4e5e738763f69145a" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", "B4D9ADA9AD7DEDF4E5E738763F69145A", "30c81c46a35ce411e5fbc1191a0a52ef", "571b242012fb7ae07fa9baac3df102e0" },
  { 192, "8e73b0f7da0e6452c810f32b809079e562f8ead2522c6b7b", "571B242012FB7AE07FA9BAAC3DF102E0", "f69f2445df4f9b17ad2b417be66c3710", "08b0e27988598881d920a9e64f5615cd" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", "000102030405060708090A0B0C0D0E0F", "6bc1bee22e409f96e93d7e117393172a", "f58c4c04d6e5f1ba779eabfb5f7bfbd6" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", "F58C4C04D6E5F1BA779EABFB5F7BFBD6", "ae2d8a571e03ac9c9eb76fac45af8e51", "9cfc4e967edb808d679f777bc6702c7d" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", "9CFC4E967EDB808D679F777BC6702C7D", "30c81c46a35ce411e5fbc1191a0a52ef", "39f23369a9d9bacfa530e26304231461" },
  { 256, "603deb1015ca71be2b73aef0857d77811f352c073b6108d72d9810a30914dff4", "39F23369A9D9BACFA530E26304231461", "f69f2445df4f9b17ad2b417be66c3710", "b2eb05e2c39be9fcda6c19078c6a9d1b" },
};

RTEST_LOOP (raes, cbc, RTEST_FAST, 0, R_N_ELEMENTS (CBC_test_data))
{
  RCryptoCipherTestData * data = &CBC_test_data[__i];
  RCryptoCipher * cipher;
  ruint8 * plaintxt, * ciphertxt, * out, iv[R_AES_BLOCK_BYTES];
  rsize plainsize, ciphersize;

  r_assert_cmpptr ((plaintxt = r_str_hex_mem (data->plaintxt, &plainsize)), !=, NULL);
  r_assert_cmpptr ((ciphertxt = r_str_hex_mem (data->ciphertxt, &ciphersize)), !=, NULL);
  r_assert_cmpuint (plainsize, ==, ciphersize);

  r_assert_cmpptr ((cipher = r_cipher_aes_new_from_hex (data->key)), !=, NULL);
  r_assert_cmpuint (cipher->keybits, ==, data->keybits);

  out = r_malloc (ciphersize);
  r_assert_cmpuint (r_str_hex_to_binary (data->iv, iv, R_AES_BLOCK_BYTES), ==, R_AES_BLOCK_BYTES);
  r_assert_cmpint (r_cipher_aes_cbc_encrypt (cipher, iv, plaintxt, plainsize, out), ==, R_CRYPTO_CIPHER_OK);
  r_assert_cmpmem (out, ==, ciphertxt, ciphersize);

  r_assert_cmpuint (r_str_hex_to_binary (data->iv, iv, R_AES_BLOCK_BYTES), ==, R_AES_BLOCK_BYTES);
  r_assert_cmpint (r_cipher_aes_cbc_decrypt (cipher, iv, ciphertxt, ciphersize, out), ==, R_CRYPTO_CIPHER_OK);
  r_assert_cmpmem (out, ==, plaintxt, plainsize);

  r_crypto_cipher_unref (cipher);
  r_free (plaintxt);
  r_free (ciphertxt);
  r_free (out);
}
RTEST_END;

